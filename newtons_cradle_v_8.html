<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Newton's Cradle â€” V8.1: ASMR Click + Click-only Input</title>
<style>
  :root{ --bg1:#0f172a; --bg2:#1e293b; --panel:#0b1220cc; --accent:#22d3ee; }
  html,body{height:100%}
  body{margin:0;display:grid;place-items:center;background:radial-gradient(1200px 600px at 70% 20%, #0b1022 0%, var(--bg1) 40%, var(--bg2) 100%);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;color:#e5e7eb}
  .wrap{width:min(1100px,95vw);display:grid;gap:12px}
  canvas{width:100%;height:auto;display:block;background:radial-gradient(circle at 60% 20%, #f8fafc, #d1d5db 55%, #9ca3af 100%);border-radius:16px;box-shadow:0 30px 80px rgba(0,0,0,.55), inset 0 2px 10px rgba(255,255,255,.35)}
  .panel{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:14px;background:var(--panel);border:1px solid #334155;backdrop-filter:blur(6px)}
  .group{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{appearance:none;border:1px solid #475569;background:#0b1220;color:#e5e7eb;padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:600;letter-spacing:.2px;box-shadow:inset 0 1px 0 rgba(255,255,255,.08), 0 2px 8px rgba(0,0,0,.35)}
  .btn:hover{border-color:#7dd3fc}
  .btn.primary{background:linear-gradient(180deg,#0ea5e9,#0284c7);border-color:#38bdf8}
  label{font-size:14px;opacity:.9}
  input[type="range"]{accent-color:var(--accent)}
  .hint{opacity:.8;font-size:13px}
</style>
</head>
<body>
  <div class="wrap">
    <canvas id="cradle" width="1100" height="620" aria-label="Interactive Newton's Cradle"></canvas>
    <div class="panel" role="group" aria-label="Controls">
      <div class="group">
        <button class="btn primary" id="reset">Reset</button>
        <button class="btn" id="stop">Stop</button>
        <button class="btn" id="pause">Pause</button>
        <button class="btn" id="preset">Match Clip</button>
      </div>
      <div class="group">
        <label>Gravity <input id="grav" type="range" min="0.0018" max="0.0045" step="0.0001" value="0.0032"></label>
        <label>Damping <input id="damp" type="range" min="0.995" max="0.9997" step="0.0001" value="0.9992"></label>
        <label>Restitution <input id="rest" type="range" min="0.985" max="0.999" step="0.0005" value="0.9985"></label>
      </div>
      <div class="group">
        <button class="btn" id="mute">Mute</button>
        <label>Volume <input id="vol" type="range" min="0" max="1" step="0.01" value="0.35"></label>
      </div>
      <div class="hint">Soft, low, ASMR-style clicks. Click an edge ball to start. Mouse movement does not affect the cradle.</div>
    </div>
  </div>
<script>
const canvas=document.getElementById("cradle");
const ctx=canvas.getContext("2d");
const btnReset=document.getElementById("reset");
const btnStop=document.getElementById("stop");
const btnPause=document.getElementById("pause");
const btnPreset=document.getElementById("preset");
const btnMute=document.getElementById("mute");
const sliderG=document.getElementById("grav");
const sliderD=document.getElementById("damp");
const sliderR=document.getElementById("rest");
const sliderV=document.getElementById("vol");
const NUM=5;const R=26;const L=280;const ORIGIN_Y=140;const SPACING=R*2.35;const ORIGIN_X=canvas.width/2-(NUM-1)*SPACING/2;
let G=parseFloat(sliderG.value);let DAMP=parseFloat(sliderD.value);let REST=parseFloat(sliderR.value);
let audioCtx=null,master=null,comp=null,muted=false,audioReady=false;
function ensureAudio(){if(audioReady)return;const C=window.AudioContext||window.webkitAudioContext;if(!C)return;audioCtx=new C();comp=audioCtx.createDynamicsCompressor();comp.threshold.value=-30;comp.knee.value=20;comp.ratio.value=6;comp.attack.value=0.003;comp.release.value=0.15;master=audioCtx.createGain();master.gain.value=parseFloat(sliderV.value);master.connect(comp).connect(audioCtx.destination);audioReady=true;}
function setGain(v){if(master&&!muted)master.gain.value=v;}
function stereoPanNode(){if(!audioCtx)return null;if(typeof audioCtx.createStereoPanner==="function"){return audioCtx.createStereoPanner();}const p=audioCtx.createPanner();p.panningModel="equalpower";return p;}
function playClink(xPos,impactVel){if(!audioReady||muted)return;audioCtx.resume();const now=audioCtx.currentTime;const pan=stereoPanNode();const normX=xPos/canvas.width*2-1;let panDest=master;if(pan){if(pan.pan){pan.pan.value=Math.max(-1,Math.min(1,normX));}else{pan.setPosition(normX,0,1);}pan.connect(master);panDest=pan;}const v=Math.min(1,Math.max(0.04,Math.abs(impactVel)/6));const overall=0.22+0.45*v;const lpCut=900+700*v;const noiseDur=0.006+0.006*v;const buffer=audioCtx.createBuffer(1,Math.max(1,Math.floor(audioCtx.sampleRate*noiseDur)),audioCtx.sampleRate);const data=buffer.getChannelData(0);for(let i=0;i<data.length;i++){data[i]=(Math.random()*2-1)*Math.exp(-i/data.length*6);}const noise=audioCtx.createBufferSource();noise.buffer=buffer;const lp=audioCtx.createBiquadFilter();lp.type="lowpass";lp.frequency.value=lpCut;lp.Q.value=0.7;const ng=audioCtx.createGain();ng.gain.value=overall*0.35;noise.connect(lp).connect(ng).connect(panDest);noise.start(now);noise.stop(now+noiseDur);const base=420;const modes=[1,2.02,2.95];modes.forEach((m,i)=>{const o=audioCtx.createOscillator();o.type="sine";o.frequency.value=base*m*(1+(Math.random()-0.5)*0.004);const g=audioCtx.createGain();const a0=overall*[0.6,0.32,0.18][i];const decay=0.16+0.14*i;g.gain.setValueAtTime(a0,now);g.gain.exponentialRampToValueAtTime(0.001,now+decay);o.connect(g).connect(panDest);o.start(now);o.stop(now+decay+0.02);});}
const lastHit=new Array(NUM-1).fill(0);const HIT_COOLDOWN_MS=26;
const balls=Array.from({length:NUM},(_,i)=>({originX:ORIGIN_X+i*SPACING,originY:ORIGIN_Y,angle:0,angVel:0}));
const BAR_MARGIN=90;const BAR_LEFT=ORIGIN_X-BAR_MARGIN;const BAR_RIGHT=ORIGIN_X+(NUM-1)*SPACING+BAR_MARGIN;
let paused=false,braking=false,frozen=false;let clickCandidate=null;
function pos(i){const b=balls[i];return{x:b.originX+Math.sin(b.angle)*L,y:b.originY+Math.cos(b.angle)*L};}
function horizVel(i){const b=balls[i];return b.angVel*L*Math.cos(b.angle);}
function stepPhysics(){if(paused||frozen)return;for(let i=0;i<NUM;i++){const b=balls[i];const accel=-G*Math.sin(b.angle);b.angVel+=accel;if(braking)b.angVel*=0.9;b.angVel*=DAMP;b.angle+=b.angVel;}for(let pass=0;pass<6;pass++){let any=false;for(let i=0;i<NUM-1;i++){const p1=pos(i),p2=pos(i+1);const dx=p2.x-p1.x;const minDist=R*2-0.5;const vrel=horizVel(i+1)-horizVel(i);if(dx<minDist&&vrel<0){const overlap=(minDist-dx)*0.5;balls[i].angle-=overlap/L;balls[i+1].angle+=overlap/L;const v1=horizVel(i),v2=horizVel(i+1);const v1p=v2*REST,v2p=v1*REST;const c1=Math.max(0.2,Math.abs(Math.cos(balls[i].angle)));const c2=Math.max(0.2,Math.abs(Math.cos(balls[i+1].angle)));balls[i].angVel=v1p/(L*c1);balls[i+1].angVel=v2p/(L*c2);any=true;const t=performance.now();if(t-lastHit[i]>HIT_COOLDOWN_MS){lastHit[i]=t;playClink((p1.x+p2.x)/2,-vrel);}}}if(!any)break;}}
function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.lineWidth=10;const postGrad=ctx.createLinearGradient(BAR_LEFT,ORIGIN_Y-60,BAR_LEFT,ORIGIN_Y+L+R+40);postGrad.addColorStop(0,"#0ea5e9");postGrad.addColorStop(1,"#0369a1");ctx.strokeStyle=postGrad;ctx.beginPath();ctx.moveTo(BAR_LEFT,ORIGIN_Y-30);ctx.lineTo(BAR_LEFT,ORIGIN_Y+L+R+25);ctx.moveTo(BAR_RIGHT,ORIGIN_Y-30);ctx.lineTo(BAR_RIGHT,ORIGIN_Y+L+R+25);ctx.stroke();const barGrad=ctx.createLinearGradient(BAR_LEFT,ORIGIN_Y,BAR_RIGHT,ORIGIN_Y);barGrad.addColorStop(0,"#94a3b8");barGrad.addColorStop(0.5,"#e2e8f0");barGrad.addColorStop(1,"#94a3b8");ctx.lineWidth=16;ctx.strokeStyle=barGrad;ctx.beginPath();ctx.moveTo(BAR_LEFT,ORIGIN_Y);ctx.lineTo(BAR_RIGHT,ORIGIN_Y);ctx.stroke();ctx.lineWidth=2;for(let i=0;i<NUM;i++){const p=pos(i);ctx.fillStyle="#0f172a";ctx.beginPath();ctx.arc(balls[i].originX,ORIGIN_Y,4,0,Math.PI*2);ctx.fill();const shine=ctx.createLinearGradient(balls[i].originX,ORIGIN_Y,p.x,p.y);shine.addColorStop(0,"#cbd5e1");shine.addColorStop(1,"#64748b");ctx.strokeStyle=shine;ctx.beginPath();ctx.moveTo(balls[i].originX,ORIGIN_Y);ctx.lineTo(p.x,p.y);ctx.stroke();const g=ctx.createRadialGradient(p.x-10,p.y-12,6,p.x,p.y,R);g.addColorStop(0,"#ffffff");g.addColorStop(0.2,"#e5e7eb");g.addColorStop(1,"#4b5563");ctx.fillStyle=g;ctx.beginPath();ctx.arc(p.x,p.y,R,0,Math.PI*2);ctx.fill();ctx.lineWidth=1;ctx.strokeStyle="rgba(0,0,0,.5)";ctx.stroke();ctx.fillStyle="rgba(255,255,255,.35)";ctx.beginPath();ctx.ellipse(p.x-8,p.y-12,7,10,-0.6,0,Math.PI*2);ctx.fill();}}
function loop(){stepPhysics();draw();requestAnimationFrame(loop);}requestAnimationFrame(loop);
function canvasCoords(e){const r=canvas.getBoundingClientRect();return{x:(e.clientX-r.left)*(canvas.width/r.width),y:(e.clientY-r.top)*(canvas.height/r.height)};}
function pickBall(mx,my){for(let i=0;i<NUM;i++){const p=pos(i);const d2=(mx-p.x)**2+(my-p.y)**2;if(d2<R*R)return i;}return null;}
canvas.addEventListener("pointerdown",e=>{ensureAudio();const{ x,y }=canvasCoords(e);if(frozen)return;const i=pickBall(x,y);clickCandidate={i,x0:x,y0:y,t:performance.now()};});
window.addEventListener("pointerup",e=>{if(!clickCandidate)return;const{ x,y }=canvasCoords(e);const dx=x-clickCandidate.x0;const dy=y-clickCandidate.y0;const moved=Math.hypot(dx,dy);const i=clickCandidate.i;clickCandidate=null;if(i==null)return;if(moved>10)return;const leftSide=i<Math.floor(NUM/2);const PULL=0.55;balls[i].angle=leftSide?-PULL:PULL;balls[i].angVel=0;frozen=false;paused=false;});
window.addEventListener("keydown",e=>{if(e.code==="Space"){ensureAudio();braking=true;}});
window.addEventListener("keyup",e=>{if(e.code==="Space"){braking=false;}});
btnReset.addEventListener("click",()=>{balls.forEach(b=>{b.angle=0;b.angVel=0});frozen=false;paused=false;btnPause.textContent="Pause";});
btnStop.addEventListener("click",()=>{balls.forEach(b=>{b.angle=0;b.angVel=0});frozen=true;paused=true;btnPause.textContent="Resume";});
btnPause.addEventListener("click",()=>{paused=!paused;btnPause.textContent=paused?"Resume":"Pause";});
btnPreset.addEventListener("click",()=>{sliderG.value="0.0033";sliderD.value="0.9992";sliderR.value="0.9988";sliderV.value="0.4";G=parseFloat(sliderG.value);DAMP=parseFloat(sliderD.value);REST=parseFloat(sliderR.value);setGain(parseFloat(sliderV.value));});
btnMute.addEventListener("click",()=>{muted=!muted;if(master){master.gain.value=muted?0:parseFloat(sliderV.value);}btnMute.textContent=muted?"Unmute":"Mute";});
sliderV.addEventListener("input",()=>{setGain(parseFloat(sliderV.value));});
sliderG.addEventListener("input",e=>G=parseFloat(e.target.value));
sliderD.addEventListener("input",e=>DAMP=parseFloat(e.target.value));
sliderR.addEventListener("input",e=>REST=parseFloat(e.target.value));
</script>
</body>
</html>
